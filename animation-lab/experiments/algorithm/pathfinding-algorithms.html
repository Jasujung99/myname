<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²½ë¡œ íƒìƒ‰ ì•Œê³ ë¦¬ì¦˜ ì‹œê°í™”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --primary-color: #2a2a2a;
            --secondary-color: #3a3a3a;
            --text-color: #e0e0e0;
            --accent-color: #00aaff;
            --start-color: #00ff88;
            --end-color: #ff4488;
            --path-color: #ffff00;
            --open-set-color: rgba(0, 255, 136, 0.5);
            --closed-set-color: rgba(255, 68, 136, 0.4);
            --wall-color: #666;
            --default-color: #2a2a2a;
            --button-active-border: #00aaff;
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        .control-panel, .learning-points {
            background-color: var(--primary-color);
            border: 1px solid var(--secondary-color);
        }
        #view {
            border: 1px solid var(--secondary-color);
            border-radius: 0.5rem;
            overflow: hidden;
            width: 100%;
            height: 500px;
            min-height: 500px;
            background-color: var(--primary-color);
        }
        .vega-embed-wrapper {
             width: 100%;
             height: 100%;
        }
        button, .back-button {
            background-color: var(--accent-color);
            color: #fff;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        button:hover, .back-button:hover {
            filter: brightness(1.2);
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
            filter: none;
        }
        .mode-btn.active {
            border-color: var(--button-active-border);
            box-shadow: 0 0 8px var(--button-active-border);
        }
        input[type="range"] {
            -webkit-appearance: none; appearance: none;
            width: 100%; height: 8px; background: var(--secondary-color);
            outline: none; opacity: 0.7; transition: opacity .2s; border-radius: 4px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px; background: var(--accent-color);
            cursor: pointer; border-radius: 50%;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px; height: 20px; background: var(--accent-color);
            cursor: pointer; border-radius: 50%; border: none;
        }
        select {
            background-color: var(--secondary-color);
            border: 1px solid var(--accent-color);
            color: var(--text-color);
        }
        .back-button {
            text-decoration: none;
            display: inline-block;
        }
        .error-message {
            color: #ff4444;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        .loading {
            color: var(--accent-color);
            text-align: center;
            padding: 2rem;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-7xl">
        <h1 class="text-3xl font-bold text-center mb-6 text-white">ê²½ë¡œ íƒìƒ‰ ì•Œê³ ë¦¬ì¦˜ ì‹œê°í™”</h1>

        <div class="flex flex-col lg:flex-row gap-6">

            <!-- ì œì–´íŒ -->
            <div id="controls-container" class="w-full lg:w-1/4 space-y-6">
                <div class="control-panel p-4 rounded-lg shadow-lg space-y-4">
                    <div>
                        <label for="algorithm" class="block text-sm font-medium mb-1">ì•Œê³ ë¦¬ì¦˜</label>
                        <select id="algorithm" class="w-full p-2 rounded-md">
                            <option value="astar">A* (ì—ì´ìŠ¤íƒ€)</option>
                            <option value="dijkstra">ë‹¤ìµìŠ¤íŠ¸ë¼ (Dijkstra)</option>
                            <option value="bfs">ë„ˆë¹„ ìš°ì„  íƒìƒ‰ (BFS)</option>
                        </select>
                    </div>
                    <div>
                        <label for="heuristic" class="block text-sm font-medium mb-1">íœ´ë¦¬ìŠ¤í‹± (A* ì „ìš©)</label>
                        <select id="heuristic" class="w-full p-2 rounded-md">
                            <option value="manhattan">ë§¨í•´íŠ¼ ê±°ë¦¬</option>
                            <option value="euclidean">ìœ í´ë¦¬ë“œ ê±°ë¦¬</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">ê²©ì ì¡°ì‘ ëª¨ë“œ</label>
                        <div class="flex flex-wrap gap-2">
                            <button id="set-start-btn" class="mode-btn flex-1 p-2 text-sm rounded-md" style="background-color: var(--start-color); color: #000;">ì‹œì‘ì </button>
                            <button id="set-end-btn" class="mode-btn flex-1 p-2 text-sm rounded-md" style="background-color: var(--end-color); color: #000;">ë„ì°©ì </button>
                            <button id="set-wall-btn" class="mode-btn flex-1 p-2 text-sm rounded-md bg-gray-500 active">ì¥ì• ë¬¼</button>
                        </div>
                    </div>
                    <div>
                        <label for="speed" class="block text-sm font-medium mb-1">ì• ë‹ˆë©”ì´ì…˜ ì†ë„</label>
                        <input type="range" id="speed" min="1" max="100" value="50" class="w-full">
                        <div class="text-xs text-gray-400 mt-1">í˜„ì¬: <span id="speed-value">50</span></div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                         <button id="start-btn" class="p-2 w-full rounded-md">ì‹œì‘</button>
                         <button id="reset-grid-btn" class="p-2 w-full rounded-md bg-red-500 hover:bg-red-600">ê²©ì ì´ˆê¸°í™”</button>
                    </div>
                    <button id="clear-path-btn" class="p-2 w-full rounded-md bg-yellow-500 text-black hover:bg-yellow-600">ê²½ë¡œ ì§€ìš°ê¸°</button>
                    <div id="status-message" class="text-sm text-center py-2"></div>
                </div>
                <a href="../../index.html" class="back-button w-full text-center p-3 rounded-lg shadow-md">&lt;- ëŒì•„ê°€ê¸°</a>
            </div>

            <!-- Vega ë·° ì»¨í…Œì´ë„ˆ -->
            <div id="canvas-container" class="w-full lg:w-2/4 flex items-center justify-center">
                <div id="view" class="w-full h-full">
                    <div class="loading">ì‹œê°í™”ë¥¼ ë¡œë”© ì¤‘...</div>
                </div>
            </div>

            <!-- í•™ìŠµ í¬ì¸íŠ¸ -->
            <div id="info-container" class="w-full lg:w-1/4">
                <div class="learning-points p-4 rounded-lg shadow-lg">
                    <h3 class="text-xl font-bold mb-3 flex items-center"><span class="text-2xl mr-2">ğŸ’¡</span> í•™ìŠµ í¬ì¸íŠ¸</h3>
                    <ul id="learning-content" class="space-y-3 text-sm"></ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // --- ì•ˆì „í•œ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ ì²´í¬ ---
        if (typeof vega === 'undefined' || typeof vegaEmbed === 'undefined') {
            document.getElementById('view').innerHTML = '<div class="error-message">Vega ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.</div>';
            throw new Error('Vega libraries not loaded');
        }

        // ê²©ì í¬ê¸° ì„¤ì • (40x30)
        const COLS = 40;
        const ROWS = 30;
        let grid = [];
        let startNode = null;
        let endNode = null;
        let vegaView = null;
        
        // ì•Œê³ ë¦¬ì¦˜ ìƒíƒœ
        let openSet = [];
        let closedSet = [];
        let path = [];
        let isSearching = false;
        let interactionMode = 'wall'; // 'start', 'end', 'wall'
        
        // ë…¸ë“œ í´ë˜ìŠ¤
        class Node {
            constructor(i, j) {
                this.i = i;
                this.j = j;
                this.f = 0;
                this.g = 0;
                this.h = 0;
                this.neighbors = [];
                this.previous = null;
                this.isWall = false;
            }
            
            addNeighbors(grid) {
                const i = this.i;
                const j = this.j;
                
                // ìƒí•˜ì¢Œìš° ì´ì›ƒ ì¶”ê°€
                if (i < COLS - 1) this.neighbors.push(grid[i + 1][j]);
                if (i > 0) this.neighbors.push(grid[i - 1][j]);
                if (j < ROWS - 1) this.neighbors.push(grid[i][j + 1]);
                if (j > 0) this.neighbors.push(grid[i][j - 1]);
            }
        }
        
        // Vega ìŠ¤í™ ìƒì„±
        function createVegaSpec() {
            const gridData = [];
            for (let i = 0; i < COLS; i++) {
                for (let j = 0; j < ROWS; j++) {
                    gridData.push({
                        i: i,
                        j: j,
                        status: "default"
                    });
                }
            }
            
            return {
                "$schema": "https://vega.github.io/schema/vega/v5.json",
                "width": 600,
                "height": 500,
                "padding": 5,
                "data": [{"name": "grid_data", "values": gridData}],
                "signals": [{"name": "gridClick", "on": [{"events": "mousedown", "update": "item()"}]}],
                "scales": [
                    { 
                        "name": "xScale", 
                        "type": "band", 
                        "domain": {"data": "grid_data", "field": "i"}, 
                        "range": "width",
                        "padding": 0.01
                    },
                    { 
                        "name": "yScale", 
                        "type": "band", 
                        "domain": {"data": "grid_data", "field": "j"}, 
                        "range": "height",
                        "padding": 0.01
                    },
                    {
                        "name": "color", 
                        "type": "ordinal",
                        "domain": ["default", "wall", "open", "closed", "path", "start", "end"],
                        "range": [
                            '#2a2a2a',                // default
                            '#666',                   // wall
                            'rgba(0, 255, 136, 0.5)', // open
                            'rgba(255, 68, 136, 0.4)',// closed
                            '#ffff00',                // path
                            '#00ff88',                // start
                            '#ff4488'                 // end
                        ]
                    }
                ],
                "marks": [{
                    "type": "rect", 
                    "from": {"data": "grid_data"},
                    "encode": {
                        "enter": {
                            "x": {"scale": "xScale", "field": "i"}, 
                            "y": {"scale": "yScale", "field": "j"},
                            "width": {"scale": "xScale", "band": 1}, 
                            "height": {"scale": "yScale", "band": 1},
                            "stroke": {"value": '#3a3a3a'},
                            "strokeWidth": {"value": 0.5}
                        },
                        "update": { 
                            "fill": {"scale": "color", "field": "status"}
                        }
                    }
                }]
            };
        }
        
        // ê²©ì ì´ˆê¸°í™”
        function resetGrid() {
            grid = [];
            for (let i = 0; i < COLS; i++) {
                grid[i] = [];
                for (let j = 0; j < ROWS; j++) {
                    grid[i][j] = new Node(i, j);
                    if (Math.random() < 0.25) {
                        grid[i][j].isWall = true;
                    }
                }
            }
            
            // ì‹œì‘ì ê³¼ ëì  ì„¤ì •
            startNode = grid[1][Math.floor(ROWS / 2)];
            endNode = grid[COLS - 2][Math.floor(ROWS / 2)];
            startNode.isWall = false;
            endNode.isWall = false;
            
            // ì´ì›ƒ ë…¸ë“œ ì„¤ì •
            for (let i = 0; i < COLS; i++) {
                for (let j = 0; j < ROWS; j++) {
                    grid[i][j].addNeighbors(grid);
                }
            }
            
            openSet = [];
            closedSet = [];
            path = [];
            
            updateVegaView();
        }
        
        // Vega ë·° ì—…ë°ì´íŠ¸
        function updateVegaView() {
            if (!vegaView) return;
            
            const data = formatGridData();
            vegaView.data('grid_data', data).run();
        }
        
        // ê²©ì ë°ì´í„° í¬ë§·íŒ…
        function formatGridData() {
            const data = [];
            for (let i = 0; i < COLS; i++) {
                for (let j = 0; j < ROWS; j++) {
                    const node = grid[i][j];
                    let status = "default";
                    
                    if (node.isWall) status = "wall";
                    else if (openSet.includes(node)) status = "open";
                    else if (closedSet.includes(node)) status = "closed";
                    
                    if (path.includes(node)) status = "path";
                    if (node === startNode) status = "start";
                    if (node === endNode) status = "end";
                    
                    data.push({i: i, j: j, status: status});
                }
            }
            return data;
        }
        
        // ê·¸ë¦¬ë“œ í´ë¦­ ì²˜ë¦¬
        function handleGridClick(name, value) {
            console.log('Grid clicked:', name, value); // ë””ë²„ê¹…ìš©
            
            if (!value || !value.datum || isSearching) return;
            
            const i = value.datum.i;
            const j = value.datum.j;
            
            console.log('Clicked position:', i, j); // ë””ë²„ê¹…ìš©
            
            if (i < 0 || i >= COLS || j < 0 || j >= ROWS) return;
            
            const node = grid[i][j];
            const mode = getActiveMode();
            
            console.log('Current mode:', mode); // ë””ë²„ê¹…ìš©
            
            switch(mode) {
                case 'start':
                    if (node !== endNode) {
                        startNode = node;
                        node.isWall = false;
                    }
                    break;
                case 'end':
                    if (node !== startNode) {
                        endNode = node;
                        node.isWall = false;
                    }
                    break;
                case 'wall':
                    if (node !== startNode && node !== endNode) {
                        node.isWall = !node.isWall;
                    }
                    break;
            }
            
            updateVegaView();
        }
        
        // í˜„ì¬ í™œì„±í™”ëœ ëª¨ë“œ ê°€ì ¸ì˜¤ê¸°
        function getActiveMode() {
            const startBtn = document.getElementById('set-start-btn');
            const endBtn = document.getElementById('set-end-btn');
            const wallBtn = document.getElementById('set-wall-btn');
            
            if (startBtn.classList.contains('active')) return 'start';
            if (endBtn.classList.contains('active')) return 'end';
            return 'wall';
        }
        
        // ìƒíƒœ ë©”ì‹œì§€ ì„¤ì •
        function setStatus(message, isError = false) {
            // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ ë¹„í™œì„±í™”
            return;
        }
        
        // íœ´ë¦¬ìŠ¤í‹± ê³„ì‚°
        function heuristic(a, b) {
            if (!a || !b) return 0;
            
            try {
                const type = document.getElementById('heuristic')?.value || 'manhattan';
                if (type === 'euclidean') {
                    return Math.sqrt(Math.pow(a.i - b.i, 2) + Math.pow(a.j - b.j, 2));
                }
                return Math.abs(a.i - b.i) + Math.abs(a.j - b.j); // manhattan
            } catch (error) {
                console.error('Error calculating heuristic:', error);
                return Math.abs(a.i - b.i) + Math.abs(a.j - b.j);
            }
        }
        
        // ì´ˆê¸°í™” í•¨ìˆ˜
        async function initialize() {
            try {
                const spec = createVegaSpec();
                const result = await vegaEmbed('#view', spec, {
                    actions: false,
                    renderer: 'canvas'
                });
                
                vegaView = result.view;
                vegaView.addSignalListener('gridClick', handleGridClick);
                
                resetGrid();
                setupEventListeners();
                updateLearningContent();
                
                console.log('Initialization complete'); // ë””ë²„ê¹…ìš©
            } catch (error) {
                console.error("ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
                document.getElementById('view').innerHTML = "<div class='error-message'>ì°¨íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.</div>";
            }
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // ëª¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
            const modeBtns = document.querySelectorAll('.mode-btn');
            modeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    modeBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    interactionMode = btn.id.replace('set-', '').replace('-btn', '');
                });
            });
            
            // ì‹¤í–‰ ì œì–´ ì´ë²¤íŠ¸
            document.getElementById('start-btn').addEventListener('click', startSearch);
            document.getElementById('clear-path-btn').addEventListener('click', clearPath);
            document.getElementById('reset-grid-btn').addEventListener('click', resetGrid);
            
            // ì•Œê³ ë¦¬ì¦˜ ë³€ê²½ ì´ë²¤íŠ¸
            document.getElementById('algorithm').addEventListener('change', updateLearningContent);
            
            // ì†ë„ ìŠ¬ë¼ì´ë”
            const speedSlider = document.getElementById('speed');
            const speedValue = document.getElementById('speed-value');
            
            speedSlider.addEventListener('input', () => {
                speedValue.textContent = speedSlider.value;
            });
        }
        
        // ì•Œê³ ë¦¬ì¦˜ ì„¤ëª… ì—…ë°ì´íŠ¸
        function updateLearningContent() {
            const algorithm = document.getElementById('algorithm').value;
            const content = document.getElementById('learning-content');
            
            const learningData = {
                astar: `<li><strong>A* ì•Œê³ ë¦¬ì¦˜:</strong> ìµœì  ê²½ë¡œë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì°¾ëŠ” íœ´ë¦¬ìŠ¤í‹± ê¸°ë°˜ íƒìƒ‰ì…ë‹ˆë‹¤.</li><li><strong>F = G + H:</strong><ul class="list-disc list-inside ml-4 mt-1"><li><strong>Gê°’:</strong> ì‹œì‘ë¶€í„° í˜„ì¬ê¹Œì§€ì˜ ì‹¤ì œ ë¹„ìš©.</li><li><strong>Hê°’ (íœ´ë¦¬ìŠ¤í‹±):</strong> í˜„ì¬ë¶€í„° ëª©í‘œê¹Œì§€ì˜ ì¶”ì • ë¹„ìš©.</li></ul></li><li><strong>ì›ë¦¬:</strong> Fê°’ì´ ê°€ì¥ ë‚®ì€ ë…¸ë“œë¥¼ ìš°ì„  íƒìƒ‰í•©ë‹ˆë‹¤.</li>`,
                dijkstra: `<li><strong>ë‹¤ìµìŠ¤íŠ¸ë¼ ì•Œê³ ë¦¬ì¦˜:</strong> íŠ¹ì • ë…¸ë“œì—ì„œ ë‹¤ë¥¸ ëª¨ë“  ë…¸ë“œê¹Œì§€ì˜ ìµœë‹¨ ê²½ë¡œë¥¼ ì°¾ìŠµë‹ˆë‹¤.</li><li><strong>ì›ë¦¬:</strong> íœ´ë¦¬ìŠ¤í‹± ì—†ì´ ìˆœìˆ˜ ë¹„ìš©(Gê°’)ì´ ê°€ì¥ ì ì€ ë…¸ë“œë¥¼ ìš°ì„  íƒìƒ‰í•˜ë©°, A*ë³´ë‹¤ íƒìƒ‰ ë²”ìœ„ê°€ ë„“ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>`,
                bfs: `<li><strong>ë„ˆë¹„ ìš°ì„  íƒìƒ‰ (BFS):</strong> ì‹œì‘ ë…¸ë“œì—ì„œ ê°€ê¹Œìš´ ë…¸ë“œë¥¼ ë¨¼ì €, ë„“ê²Œ íƒìƒ‰í•©ë‹ˆë‹¤.</li><li><strong>ì›ë¦¬:</strong> í(Queue)ë¥¼ ì‚¬ìš©í•˜ë©°, ê°„ì„  ë¹„ìš©ì´ ê°™ì„ ë•Œ ìµœë‹¨ ê²½ë¡œë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.</li>`
            };
            
            if (content && learningData[algorithm]) {
                content.innerHTML = learningData[algorithm];
            }
            
            const heuristicSelect = document.getElementById('heuristic');
            if (heuristicSelect) {
                heuristicSelect.disabled = algorithm !== 'astar';
            }
        }
        
        // ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
        let animationFrameId = null;
        
        // ê²½ë¡œ íƒìƒ‰ ì‹œì‘
        function startSearch() {
            if (isSearching) {
                // ì¤‘ì§€
                isSearching = false;
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                document.getElementById('start-btn').textContent = 'ì‹œì‘';
                return;
            }
            
            clearPath();
            
            openSet = [startNode];
            closedSet = [];
            path = [];
            isSearching = true;
            
            const algorithm = document.getElementById('algorithm').value;
            document.getElementById('start-btn').textContent = 'ì¤‘ì§€';
            
            requestAnimationFrame(animate);
        }
        
        // ì•Œê³ ë¦¬ì¦˜ ëª…ì¹­ ê°€ì ¸ì˜¤ê¸°
        function getAlgorithmName(algorithm) {
            switch(algorithm) {
                case 'astar': return 'A* ì•Œê³ ë¦¬ì¦˜';
                case 'dijkstra': return 'ë‹¤ìµìŠ¤íŠ¸ë¼ ì•Œê³ ë¦¬ì¦˜';
                case 'bfs': return 'ë„ˆë¹„ ìš°ì„  íƒìƒ‰ (BFS)';
                default: return 'ì•Œ ìˆ˜ ì—†ëŠ” ì•Œê³ ë¦¬ì¦˜';
            }
        }
        
        // ì• ë‹ˆë©”ì´ì…˜ ë‹¨ê³„ ì‹¤í–‰
        function animate() {
            if (!isSearching) return;
            
            const speed = parseInt(document.getElementById('speed').value || '50', 10);
            const stepsPerFrame = Math.ceil(Math.max(1, speed) / 20);
            
            let result = "searching";
            for (let i = 0; i < stepsPerFrame && result === "searching"; i++) {
                result = step();
            }
            
            switch(result) {
                case "found":
                    reconstructPath();
                    isSearching = false;
                    document.getElementById('start-btn').textContent = 'ì‹œì‘';
                    break;
                case "not-found":
                    isSearching = false;
                    document.getElementById('start-btn').textContent = 'ì‹œì‘';
                    break;
                case "searching":
                    animationFrameId = requestAnimationFrame(animate);
                    break;
            }
            
            updateVegaView();
        }
        
        // ì•Œê³ ë¦¬ì¦˜ ë‹¨ê³„ ì‹¤í–‰
        function step() {
            if (openSet.length > 0) {
                const algorithm = document.getElementById('algorithm').value;
                let current;
                
                if (algorithm === 'bfs') {
                    current = openSet.shift();
                } else {
                    let lowestIndex = 0;
                    for (let i = 0; i < openSet.length; i++) {
                        if (openSet[i].f < openSet[lowestIndex].f) {
                            lowestIndex = i;
                        }
                    }
                    current = openSet[lowestIndex];
                    openSet.splice(lowestIndex, 1);
                }
                
                if (current === endNode) {
                    return "found";
                }
                
                closedSet.push(current);
                
                for (const neighbor of current.neighbors) {
                    if (neighbor.isWall || closedSet.includes(neighbor)) continue;
                    
                    const tempG = current.g + 1;
                    let newPath = false;
                    
                    if (openSet.includes(neighbor)) {
                        if (tempG < neighbor.g) {
                            neighbor.g = tempG;
                            newPath = true;
                        }
                    } else {
                        neighbor.g = tempG;
                        newPath = true;
                        openSet.push(neighbor);
                    }
                    
                    if (newPath) {
                        neighbor.h = heuristic(neighbor, endNode);
                        
                        if (algorithm === 'dijkstra') {
                            neighbor.f = neighbor.g;
                        } else if (algorithm === 'bfs') {
                            neighbor.f = 0;
                        } else {
                            neighbor.f = neighbor.g + neighbor.h;
                        }
                        
                        neighbor.previous = current;
                    }
                }
                
                return "searching";
            } else {
                return "not-found";
            }
        }
        
        // ìµœì¢… ê²½ë¡œ ì¬êµ¬ì„±
        function reconstructPath() {
            path = [];
            let temp = endNode;
            
            while (temp && temp.previous) {
                path.push(temp);
                temp = temp.previous;
            }
            
            updateVegaView();
        }
        
        // ê²½ë¡œ ì´ˆê¸°í™”
        function clearPath() {
            if (isSearching) {
                isSearching = false;
                if (animationFrameId) {
                    cancelAnimationFrame(animationFrameId);
                    animationFrameId = null;
                }
                document.getElementById('start-btn').textContent = 'ì‹œì‘';
            }
            
            openSet = [];
            closedSet = [];
            path = [];
            
            for (let i = 0; i < COLS; i++) {
                for (let j = 0; j < ROWS; j++) {
                    let node = grid[i][j];
                    node.f = 0;
                    node.g = 0;
                    node.h = 0;
                    node.previous = null;
                }
            }
            
            updateVegaView();
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
