<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°í•˜í•™ì  ë³€í™˜ - í–‰ë ¬ì˜ ë§ˆë²• - Animation Lab</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.22.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.6.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.21.0"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow: hidden;
        }

        .container {
            display: flex;
            width: 100vw;
            height: 100vh;
        }

        .canvas-area {
            flex: 1;
            position: relative;
            background: radial-gradient(circle at center, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.3) 100%);
        }

        #mainCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        #matrixVisualization {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            width: 300px;
            z-index: 2;
            border: 1px solid rgba(255,255,255,0.2);
            font-family: 'Courier New', monospace;
        }

        .matrix-title {
            font-size: 14px;
            margin-bottom: 10px;
            color: #4FC3F7;
            text-align: center;
        }

        .matrix-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-bottom: 15px;
        }

        .matrix-cell {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            padding: 8px;
            text-align: center;
            font-size: 14px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .matrix-highlight {
            background: rgba(79, 195, 247, 0.3);
            border-color: #4FC3F7;
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        .basis-vectors {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .basis-vector {
            text-align: center;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            padding: 8px;
            width: 45%;
        }

        .basis-label {
            color: #4FC3F7;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .vector-value {
            font-size: 14px;
        }

        .axis-info {
            margin-top: 10px;
            font-size: 12px;
            opacity: 0.7;
            text-align: center;
        }

        .shape-selector {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
            display: flex;
            gap: 10px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .shape-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 10px 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .shape-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .shape-btn.active {
            background: rgba(79, 195, 247, 0.3);
            border-color: #4FC3F7;
            box-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }

        .animation-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 3;
            display: flex;
            gap: 10px;
        }

        .anim-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 10px 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .anim-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .anim-btn.active {
            background: rgba(79, 195, 247, 0.3);
            border-color: #4FC3F7;
        }

        .control-panel {
            width: 350px;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(15px);
            border-left: 1px solid rgba(255,255,255,0.1);
            padding: 20px;
            overflow-y: auto;
        }

        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .back-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-1px);
        }

        .experiment-title {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
        }

        .experiment-desc {
            font-size: 0.9rem;
            opacity: 0.8;
            text-align: center;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .control-group {
            margin-bottom: 25px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }

        .control-group:hover {
            background: rgba(255,255,255,0.08);
        }

        .control-group h3 {
            margin-bottom: 15px;
            color: #4FC3F7;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-item {
            margin-bottom: 15px;
        }

        .control-item label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: rgba(255,255,255,0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #4FC3F7;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(79, 195, 247, 0.4);
        }

        .value-display {
            min-width: 50px;
            text-align: center;
            font-family: 'Courier New', monospace;
            color: #4FC3F7;
            font-weight: bold;
        }

        .transform-queue {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .queue-title {
            font-size: 14px;
            margin-bottom: 10px;
            color: #4FC3F7;
        }

        .transform-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .transform-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .transform-type {
            color: #4FC3F7;
            font-weight: bold;
        }

        .remove-btn {
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid rgba(255, 100, 100, 0.3);
            color: #ff6464;
            padding: 2px 6px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s ease;
        }

        .remove-btn:hover {
            background: rgba(255, 100, 100, 0.4);
            transform: scale(1.1);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            background: rgba(79, 195, 247, 0.2);
            border: 1px solid #4FC3F7;
            color: white;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .action-btn:hover {
            background: rgba(79, 195, 247, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 195, 247, 0.3);
        }

        .basis-vector-area {
            position: absolute;
            left: 20px;
            top: 20px;
            z-index: 2;
            width: 200px;
        }

        .vector-indicator {
            padding: 10px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .vector-indicator h4 {
            color: #4FC3F7;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .vector-coords {
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .info-section {
            margin-top: 20px;
            background: rgba(79, 195, 247, 0.1);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(79, 195, 247, 0.3);
        }

        .info-section h4 {
            color: #4FC3F7;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .info-section p {
            font-size: 0.85rem;
            line-height: 1.4;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .formula {
            font-family: 'Courier New', monospace;
            background: rgba(0,0,0,0.3);
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            font-size: 0.8rem;
            color: #4FC3F7;
        }

        .animated-cell {
            animation: pulse 1.5s infinite alternate;
        }

        @keyframes pulse {
            from { background: rgba(79, 195, 247, 0.1); }
            to { background: rgba(79, 195, 247, 0.4); }
        }

        .step-indicator {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 18px;
            color: white;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 3;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .step-indicator.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ìº”ë²„ìŠ¤ ì˜ì—­ -->
        <div class="canvas-area">
            <canvas id="mainCanvas"></canvas>
            
            <!-- í–‰ë ¬ ì‹œê°í™” -->
            <div id="matrixVisualization">
                <div class="matrix-title">ë³€í™˜ í–‰ë ¬</div>
                <div class="matrix-container" id="transformMatrix">
                    <div class="matrix-cell">1.00</div>
                    <div class="matrix-cell">0.00</div>
                    <div class="matrix-cell">0.00</div>
                    <div class="matrix-cell">0.00</div>
                    <div class="matrix-cell">1.00</div>
                    <div class="matrix-cell">0.00</div>
                    <div class="matrix-cell">0.00</div>
                    <div class="matrix-cell">0.00</div>
                    <div class="matrix-cell">1.00</div>
                </div>
                
                <div class="basis-vectors">
                    <div class="basis-vector">
                        <div class="basis-label">i ê¸°ì €ë²¡í„°</div>
                        <div class="vector-value" id="iVector">[1.00, 0.00]</div>
                    </div>
                    <div class="basis-vector">
                        <div class="basis-label">j ê¸°ì €ë²¡í„°</div>
                        <div class="vector-value" id="jVector">[0.00, 1.00]</div>
                    </div>
                </div>
                
                <div class="axis-info">
                    ë³€í™˜ í–‰ë ¬ì€ ì¢Œí‘œê³„ê°€ ì–´ë–»ê²Œ ë³€í™˜ë˜ëŠ”ì§€ ë³´ì—¬ì¤ë‹ˆë‹¤
                </div>
            </div>

            <!-- ë‹¨ê³„ í‘œì‹œê¸° -->
            <div class="step-indicator" id="stepIndicator">0/0 - ê¸°ë³¸ ë„í˜•</div>
            
            <!-- ë„í˜• ì„ íƒê¸° -->
            <div class="shape-selector">
                <button class="shape-btn" data-shape="triangle">â–² ì‚¼ê°í˜•</button>
                <button class="shape-btn" data-shape="square">â–  ì‚¬ê°í˜•</button>
                <button class="shape-btn" data-shape="pentagon">â¬Ÿ ì˜¤ê°í˜•</button>
                <button class="shape-btn" data-shape="star">â˜… ë³„</button>
                <button class="shape-btn active" data-shape="arrow">â¤ í™”ì‚´í‘œ</button>
            </div>

            <!-- ì• ë‹ˆë©”ì´ì…˜ ì»¨íŠ¸ë¡¤ -->
            <div class="animation-controls">
                <button class="anim-btn" id="playPauseBtn">â–¶ ì¬ìƒ</button>
                <button class="anim-btn" id="resetBtn">âŸ² ë¦¬ì…‹</button>
                <button class="anim-btn" id="stepBtn">â­ ë‹¨ê³„ë³„</button>
            </div>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="control-panel">
            <div class="nav-header">
                <a href="../../index.html" class="back-btn">â† ëŒì•„ê°€ê¸°</a>
            </div>

            <h1 class="experiment-title">ê¸°í•˜í•™ì  ë³€í™˜</h1>
            <p class="experiment-desc">
                í–‰ë ¬ì„ ì‚¬ìš©í•œ 2D ê¸°í•˜í•™ì  ë³€í™˜ì„ ì‹œê°ì ìœ¼ë¡œ íƒí—˜í•´ë³´ì„¸ìš”. 
                íšŒì „, í¬ê¸° ì¡°ì ˆ, ì „ë‹¨, ë°˜ì‚¬ ë“±ì˜ ë³€í™˜ì„ ì¡°í•©í•˜ì—¬ ë³µì¡í•œ ë³€í™˜ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.
            </p>

            <!-- íšŒì „ ì œì–´ -->
            <div class="control-group">
                <h3>ğŸ”„ íšŒì „ (Rotation)</h3>
                <div class="control-item">
                    <label>ê°ë„ (ë„)</label>
                    <div class="slider-container">
                        <input type="range" id="rotationSlider" min="0" max="360" value="0" step="1">
                        <div class="value-display" id="rotationValue">0Â°</div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="action-btn" id="addRotationBtn">ì ìš©í•˜ê¸°</button>
                </div>
            </div>

            <!-- í¬ê¸° ì¡°ì ˆ ì œì–´ -->
            <div class="control-group">
                <h3>ğŸ“ í¬ê¸° ì¡°ì ˆ (Scale)</h3>
                <div class="control-item">
                    <label>Xì¶• í¬ê¸°</label>
                    <div class="slider-container">
                        <input type="range" id="scaleXSlider" min="0.1" max="3" value="1" step="0.1">
                        <div class="value-display" id="scaleXValue">1.0</div>
                    </div>
                </div>
                <div class="control-item">
                    <label>Yì¶• í¬ê¸°</label>
                    <div class="slider-container">
                        <input type="range" id="scaleYSlider" min="0.1" max="3" value="1" step="0.1">
                        <div class="value-display" id="scaleYValue">1.0</div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="action-btn" id="addScaleBtn">ì ìš©í•˜ê¸°</button>
                </div>
            </div>

            <!-- ì „ë‹¨ ë³€í™˜ ì œì–´ -->
            <div class="control-group">
                <h3>ğŸ”€ ì „ë‹¨ ë³€í™˜ (Shear)</h3>
                <div class="control-item">
                    <label>Xì¶• ì „ë‹¨</label>
                    <div class="slider-container">
                        <input type="range" id="shearXSlider" min="-2" max="2" value="0" step="0.1">
                        <div class="value-display" id="shearXValue">0.0</div>
                    </div>
                </div>
                <div class="control-item">
                    <label>Yì¶• ì „ë‹¨</label>
                    <div class="slider-container">
                        <input type="range" id="shearYSlider" min="-2" max="2" value="0" step="0.1">
                        <div class="value-display" id="shearYValue">0.0</div>
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="action-btn" id="addShearBtn">ì ìš©í•˜ê¸°</button>
                </div>
            </div>

            <!-- ë°˜ì‚¬ ë³€í™˜ ì œì–´ -->
            <div class="control-group">
                <h3>ğŸª ë°˜ì‚¬ (Reflection)</h3>
                <div class="action-buttons">
                    <button class="action-btn" id="reflectXBtn">Xì¶• ë°˜ì‚¬</button>
                    <button class="action-btn" id="reflectYBtn">Yì¶• ë°˜ì‚¬</button>
                </div>
            </div>

            <!-- ë³€í™˜ í -->
            <div class="transform-queue">
                <div class="queue-title">ì ìš©ëœ ë³€í™˜ ìˆœì„œ</div>
                <div id="transformList">
                    <div style="text-align: center; opacity: 0.6; font-size: 13px;">
                        ë³€í™˜ì´ ì¶”ê°€ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="action-btn" id="clearBtn">ëª¨ë‘ ì§€ìš°ê¸°</button>
                </div>
            </div>

            <!-- ì •ë³´ ì„¹ì…˜ -->
            <div class="info-section">
                <h4>ğŸ“š ë³€í™˜ í–‰ë ¬ ì´ë¡ </h4>
                <p><strong>íšŒì „ í–‰ë ¬:</strong></p>
                <div class="formula">
                    R(Î¸) = [cos(Î¸) -sin(Î¸)]<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[sin(Î¸)  cos(Î¸)]
                </div>
                <p><strong>í¬ê¸° ì¡°ì ˆ í–‰ë ¬:</strong></p>
                <div class="formula">
                    S(sx,sy) = [sx  0]<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ 0 sy]
                </div>
                <p><strong>ì „ë‹¨ ë³€í™˜ í–‰ë ¬:</strong></p>
                <div class="formula">
                    H(hx,hy) = [ 1 hx]<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[hy  1]
                </div>
                <p><strong>ë°˜ì‚¬ ë³€í™˜ í–‰ë ¬:</strong></p>
                <div class="formula">
                    <!-- Xì¶• ë°˜ì‚¬ (ìƒí•˜ ë°˜ì „) -->
                    R<sub>x</sub> = [ 1  0]<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ 0 -1]<br>
                    <!-- Yì¶• ë°˜ì‚¬ (ì¢Œìš° ë°˜ì „) -->
                    R<sub>y</sub> = [-1  0]<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ 0  1]
                </div>
                <p><strong>ğŸ’¡ íŒ:</strong> í™”ì‚´í‘œ ë„í˜•ì„ ì„ íƒí•˜ë©´ ë°˜ì‚¬ íš¨ê³¼ê°€ ë” ëª…í™•í•˜ê²Œ ë³´ì…ë‹ˆë‹¤!</p>
                <p>ë³€í™˜ì˜ ìˆœì„œê°€ ì¤‘ìš”í•©ë‹ˆë‹¤! í–‰ë ¬ ê³±ì…ˆì€ êµí™˜ë²•ì¹™ì´ ì„±ë¦½í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
            </div>
        </div>
    </div>

    <script>
        // ìˆ˜í•™ ìœ í‹¸ë¦¬í‹°
        class MathUtil {
            // í–‰ë ¬ ê³±ì…ˆ: [3x3] * [3x3]
            static multiplyMatrix(a, b) {
                const result = [
                    [0, 0, 0],
                    [0, 0, 0],
                    [0, 0, 0]
                ];
                
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        for (let k = 0; k < 3; k++) {
                            result[i][j] += a[i][k] * b[k][j];
                        }
                    }
                }
                
                return result;
            }
            
            // ì  ë³€í™˜: [3x3] * [x, y, 1]
            static transformPoint(matrix, point) {
                const x = matrix[0][0] * point.x + matrix[0][1] * point.y + matrix[0][2];
                const y = matrix[1][0] * point.x + matrix[1][1] * point.y + matrix[1][2];
                return { x, y };
            }
            
            // ë‹¨ìœ„ í–‰ë ¬ ìƒì„±
            static identityMatrix() {
                return [
                    [1, 0, 0],
                    [0, 1, 0],
                    [0, 0, 1]
                ];
            }
            
            // ê°ë„ë¥¼ ë¼ë””ì•ˆìœ¼ë¡œ ë³€í™˜
            static toRadians(degrees) {
                return degrees * Math.PI / 180;
            }
            
            // ìˆ«ìë¥¼ ì§€ì •ëœ ì†Œìˆ˜ì  ìë¦¬ê¹Œì§€ í¬ë§·íŒ…
            static formatNumber(num, digits = 2) {
                return num.toFixed(digits);
            }
        }
        
        // ë³€í™˜ í´ë˜ìŠ¤
        class Transform {
            constructor(type, params = {}) {
                this.type = type;
                this.params = params;
                this.id = Date.now() + Math.random().toString(36).substr(2, 5);
                this.matrix = this.calculateMatrix();
            }
            
            // ë³€í™˜ íƒ€ì…ì— ë”°ë¥¸ í–‰ë ¬ ê³„ì‚°
            calculateMatrix() {
                switch (this.type) {
                    case 'rotation':
                        return this.getRotationMatrix();
                    case 'scale':
                        return this.getScaleMatrix();
                    case 'shear':
                        return this.getShearMatrix();
                    case 'reflectX':
                        return this.getReflectionXMatrix();
                    case 'reflectY':
                        return this.getReflectionYMatrix();
                    default:
                        return MathUtil.identityMatrix();
                }
            }
            
            // íšŒì „ í–‰ë ¬
            getRotationMatrix() {
                const angle = MathUtil.toRadians(this.params.angle || 0);
                const cos = Math.cos(angle);
                const sin = Math.sin(angle);
                
                return [
                    [cos, -sin, 0],
                    [sin, cos, 0],
                    [0, 0, 1]
                ];
            }
            
            // í¬ê¸° ì¡°ì ˆ í–‰ë ¬
            getScaleMatrix() {
                const sx = this.params.sx !== undefined ? this.params.sx : 1;
                const sy = this.params.sy !== undefined ? this.params.sy : 1;
                
                return [
                    [sx, 0, 0],
                    [0, sy, 0],
                    [0, 0, 1]
                ];
            }
            
            // ì „ë‹¨ í–‰ë ¬
            getShearMatrix() {
                const shx = this.params.shx !== undefined ? this.params.shx : 0;
                const shy = this.params.shy !== undefined ? this.params.shy : 0;
                
                return [
                    [1, shx, 0],
                    [shy, 1, 0],
                    [0, 0, 1]
                ];
            }
            
            // Xì¶• ë°˜ì‚¬ í–‰ë ¬
            getReflectionXMatrix() {
                return [
                    [1, 0, 0],
                    [0, -1, 0],
                    [0, 0, 1]
                ];
            }
            
            // Yì¶• ë°˜ì‚¬ í–‰ë ¬
            getReflectionYMatrix() {
                return [
                    [-1, 0, 0],
                    [0, 1, 0],
                    [0, 0, 1]
                ];
            }
            
            // ì‚¬ëŒì´ ì½ì„ ìˆ˜ ìˆëŠ” ì„¤ëª… ìƒì„±
            getDescription() {
                switch (this.type) {
                    case 'rotation':
                        return `íšŒì „ ${this.params.angle}Â°`;
                    case 'scale':
                        return `í¬ê¸° ì¡°ì ˆ (${this.params.sx}, ${this.params.sy})`;
                    case 'shear':
                        return `ì „ë‹¨ (${this.params.shx}, ${this.params.shy})`;
                    case 'reflectX':
                        return 'Xì¶• ë°˜ì‚¬';
                    case 'reflectY':
                        return 'Yì¶• ë°˜ì‚¬';
                    default:
                        return 'ì•Œ ìˆ˜ ì—†ëŠ” ë³€í™˜';
                }
            }
        }
        
        // ë„í˜• í´ë˜ìŠ¤
        class Shape {
            constructor(type = 'triangle') {
                this.type = type;
                this.originalPoints = this.getOriginalPoints();
                this.transformedPoints = [...this.originalPoints];
                this.matrix = MathUtil.identityMatrix();
            }
            
            // ë„í˜• íƒ€ì…ì— ë”°ë¥¸ ì  ì •ì˜
            getOriginalPoints() {
                switch (this.type) {
                    case 'triangle':
                        return [
                            { x: 0, y: -50 },
                            { x: -43, y: 25 },
                            { x: 43, y: 25 },
                            // ë¹„ëŒ€ì¹­ ìš”ì†Œ ì¶”ê°€ë¡œ ë°˜ì‚¬ íš¨ê³¼ë¥¼ ë” ëª…í™•í•˜ê²Œ
                            { x: 25, y: -10 }
                        ];
                    case 'square':
                        return [
                            { x: -40, y: -40 },
                            { x: 40, y: -40 },
                            { x: 40, y: 40 },
                            { x: -40, y: 40 }
                        ];
                    case 'pentagon':
                        return [
                            { x: 0, y: -50 },
                            { x: 48, y: -15 },
                            { x: 29, y: 40 },
                            { x: -29, y: 40 },
                            { x: -48, y: -15 }
                        ];
                    case 'star':
                        return [
                            { x: 0, y: -50 },
                            { x: 15, y: -15 },
                            { x: 50, y: -15 },
                            { x: 25, y: 10 },
                            { x: 30, y: 50 },
                            { x: 0, y: 25 },
                            { x: -30, y: 50 },
                            { x: -25, y: 10 },
                            { x: -50, y: -15 },
                            { x: -15, y: -15 }
                        ];
                    case 'arrow':
                        return [
                            { x: -30, y: -10 },
                            { x: 20, y: -10 },
                            { x: 20, y: -25 },
                            { x: 50, y: 0 },
                            { x: 20, y: 25 },
                            { x: 20, y: 10 },
                            { x: -30, y: 10 }
                        ];
                    default:
                        return [
                            { x: 0, y: -50 },
                            { x: -43, y: 25 },
                            { x: 43, y: 25 }
                        ];
                }
            }
            
            // ë„í˜• íƒ€ì… ë³€ê²½
            setType(type) {
                this.type = type;
                this.originalPoints = this.getOriginalPoints();
                this.applyTransform();
            }
            
            // ë³€í™˜ ì ìš©
            applyTransform() {
                this.transformedPoints = this.originalPoints.map(point => 
                    MathUtil.transformPoint(this.matrix, point)
                );
            }
            
            // ë³€í™˜ í–‰ë ¬ ì„¤ì •
            setTransformMatrix(matrix) {
                this.matrix = matrix;
                this.applyTransform();
            }
            
            // ë„í˜• ê·¸ë¦¬ê¸°
            draw(ctx, centerX, centerY) {
                if (this.transformedPoints.length === 0) return;
                
                ctx.beginPath();
                ctx.moveTo(
                    centerX + this.transformedPoints[0].x, 
                    centerY + this.transformedPoints[0].y
                );
                
                for (let i = 1; i < this.transformedPoints.length; i++) {
                    ctx.lineTo(
                        centerX + this.transformedPoints[i].x,
                        centerY + this.transformedPoints[i].y
                    );
                }
                
                ctx.closePath();
                ctx.strokeStyle = '#4FC3F7';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.fillStyle = 'rgba(79, 195, 247, 0.2)';
                ctx.fill();
                
                // ì›ì  í‘œì‹œ
                ctx.beginPath();
                ctx.arc(centerX, centerY, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#FF5252';
                ctx.fill();
            }
        }
        
        // ë³€í™˜ í ê´€ë¦¬ í´ë˜ìŠ¤
        class TransformQueue {
            constructor(onUpdateCallback) {
                this.queue = [];
                this.listElement = document.getElementById('transformList');
                this.onUpdateCallback = onUpdateCallback;
            }
            
            // ë³€í™˜ ì¶”ê°€
            add(transform) {
                this.queue.push(transform);
                this.updateUI();
                
                if (this.onUpdateCallback) {
                    this.onUpdateCallback();
                }
            }
            
            // ë³€í™˜ ì œê±°
            remove(index) {
                if (index >= 0 && index < this.queue.length) {
                    this.queue.splice(index, 1);
                    this.updateUI();
                    
                    if (this.onUpdateCallback) {
                        this.onUpdateCallback();
                    }
                }
            }
            
            // ë³€í™˜ í ì´ˆê¸°í™”
            clear() {
                this.queue = [];
                this.updateUI();
                
                if (this.onUpdateCallback) {
                    this.onUpdateCallback();
                }
            }
            
            // UI ì—…ë°ì´íŠ¸
            updateUI() {
                if (this.queue.length === 0) {
                    this.listElement.innerHTML = '<div style="text-align: center; opacity: 0.6; font-size: 13px;">ë³€í™˜ì´ ì¶”ê°€ë˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
                    return;
                }
                
                this.listElement.innerHTML = '';
                this.queue.forEach((transform, index) => {
                    const item = document.createElement('div');
                    item.className = 'transform-item';
                    
                    item.innerHTML = `
                        <span class="transform-type">${index + 1}. ${transform.getDescription()}</span>
                        <button class="remove-btn" data-index="${index}">Ã—</button>
                    `;
                    
                    this.listElement.appendChild(item);
                });
                
                // ì‚­ì œ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                const removeButtons = this.listElement.querySelectorAll('.remove-btn');
                removeButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.target.dataset.index, 10);
                        this.remove(index);
                    });
                });
            }
            
            // ë³µí•© ë³€í™˜ í–‰ë ¬ ê³„ì‚°
            calculateCompositeMatrix() {
                let matrix = MathUtil.identityMatrix();
                
                this.queue.forEach(transform => {
                    matrix = MathUtil.multiplyMatrix(matrix, transform.matrix);
                });
                
                return matrix;
            }
            
            // ë³€í™˜ íì˜ ê¸¸ì´ ë°˜í™˜
            get length() {
                return this.queue.length;
            }
            
            // ë³€í™˜ íì—ì„œ íŠ¹ì • ì¸ë±ìŠ¤ì˜ í•­ëª© ë°˜í™˜
            getAt(index) {
                if (index >= 0 && index < this.queue.length) {
                    return this.queue[index];
                }
                return null;
            }
        }
        
        // í–‰ë ¬ ì‹œê°í™” í´ë˜ìŠ¤
        class MatrixVisualization {
            constructor() {
                this.matrixElement = document.getElementById('transformMatrix');
                this.iVectorElement = document.getElementById('iVector');
                this.jVectorElement = document.getElementById('jVector');
                this.cells = this.matrixElement.querySelectorAll('.matrix-cell');
            }
            
            // í–‰ë ¬ ì—…ë°ì´íŠ¸
            update(matrix) {
                // í–‰ë ¬ ì…€ ì—…ë°ì´íŠ¸
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        const index = i * 3 + j;
                        if (index < this.cells.length) {
                            this.cells[index].textContent = MathUtil.formatNumber(matrix[i][j]);
                        }
                    }
                }
                
                // ê¸°ì €ë²¡í„° ì—…ë°ì´íŠ¸ (i, j)
                this.iVectorElement.textContent = `[${MathUtil.formatNumber(matrix[0][0])}, ${MathUtil.formatNumber(matrix[1][0])}]`;
                this.jVectorElement.textContent = `[${MathUtil.formatNumber(matrix[0][1])}, ${MathUtil.formatNumber(matrix[1][1])}]`;
            }
            
            // í–‰ë ¬ ì…€ í•˜ì´ë¼ì´íŠ¸
            highlightCell(row, col) {
                const index = row * 3 + col;
                if (index < this.cells.length) {
                    this.cells[index].classList.add('matrix-highlight');
                }
            }
            
            // í–‰ë ¬ ì…€ í•˜ì´ë¼ì´íŠ¸ ì œê±°
            clearHighlights() {
                this.cells.forEach(cell => {
                    cell.classList.remove('matrix-highlight');
                });
            }
            
            // ì…€ ì• ë‹ˆë©”ì´ì…˜
            animateCell(row, col, duration = 1000) {
                const index = row * 3 + col;
                if (index < this.cells.length) {
                    this.cells[index].classList.add('animated-cell');
                    
                    setTimeout(() => {
                        this.cells[index].classList.remove('animated-cell');
                    }, duration);
                }
            }
        }
        
        // ì• ë‹ˆë©”ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤
        class AnimationController {
            constructor(onStepCallback, onResetCallback) {
                this.isPlaying = false;
                this.currentStep = 0;
                this.totalSteps = 0;
                this.onStepCallback = onStepCallback;
                this.onResetCallback = onResetCallback;
                this.stepIndicator = document.getElementById('stepIndicator');
                this.animationSpeed = 1500; // ë°€ë¦¬ì´ˆ ë‹¨ìœ„
                this.animationTimer = null;
                
                this.setupEventListeners();
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners() {
                document.getElementById('playPauseBtn').addEventListener('click', () => {
                    this.setTotalSteps(this.getTransformQueueLength());
                    this.togglePlayPause();
                });
                document.getElementById('resetBtn').addEventListener('click', () => this.reset());
                document.getElementById('stepBtn').addEventListener('click', () => {
                    this.setTotalSteps(this.getTransformQueueLength());
                    this.nextStep();
                });
            }
            
            // ë³€í™˜ í ê¸¸ì´ ê°€ì ¸ì˜¤ê¸° (ì™¸ë¶€ì—ì„œ ì„¤ì •)
            getTransformQueueLength() {
                return this.transformQueueLength || 0;
            }
            
            // ë³€í™˜ í ê¸¸ì´ ì„¤ì •
            setTransformQueueLength(length) {
                this.transformQueueLength = length;
            }
            
            // ì¬ìƒ/ì¼ì‹œì •ì§€ í† ê¸€
            togglePlayPause() {
                this.isPlaying = !this.isPlaying;
                const button = document.getElementById('playPauseBtn');
                
                if (this.isPlaying) {
                    button.textContent = 'â¸ ì¼ì‹œì •ì§€';
                    button.classList.add('active');
                    // ì¬ìƒ ì‹œ í•­ìƒ 0ë‹¨ê³„ë¶€í„° ì‹œì‘
                    this.currentStep = 0;
                    this.playAnimation();
                } else {
                    button.textContent = 'â–¶ ì¬ìƒ';
                    button.classList.remove('active');
                    this.pauseAnimation();
                }
            }
            
            // ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ
            playAnimation() {
                if (this.totalSteps === 0) return;
                
                // 0ë‹¨ê³„ë¶€í„° ì‹œì‘í•˜ë„ë¡ ì½œë°± í˜¸ì¶œ
                if (this.onStepCallback) {
                    this.onStepCallback(this.currentStep);
                }
                
                this.clearTimer();
                this.animationTimer = setInterval(() => {
                    this.nextStep();
                    
                    if (this.currentStep >= this.totalSteps) {
                        this.pauseAnimation();
                        this.currentStep = 0;
                    }
                }, this.animationSpeed);
            }
            
            // ì• ë‹ˆë©”ì´ì…˜ ì¼ì‹œì •ì§€
            pauseAnimation() {
                this.isPlaying = false;
                document.getElementById('playPauseBtn').textContent = 'â–¶ ì¬ìƒ';
                document.getElementById('playPauseBtn').classList.remove('active');
                this.clearTimer();
            }
            
            // íƒ€ì´ë¨¸ ì œê±°
            clearTimer() {
                if (this.animationTimer !== null) {
                    clearInterval(this.animationTimer);
                    this.animationTimer = null;
                }
            }
            
            // ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™
            nextStep() {
                if (this.currentStep < this.totalSteps) {
                    this.currentStep++;
                } else {
                    // ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œ 0ë‹¨ê³„(ê¸°ë³¸ ë„í˜•)ë¡œ ëŒì•„ê°€ê¸°
                    this.currentStep = 0;
                }
                
                if (this.onStepCallback) {
                    this.onStepCallback(this.currentStep);
                }
            }
            
            // ë¦¬ì…‹
            reset() {
                this.pauseAnimation();
                this.currentStep = 0;
                this.updateStepIndicator();
                
                if (this.onResetCallback) {
                    this.onResetCallback();
                }
            }
            
            // ë‹¨ê³„ í‘œì‹œê¸° ì—…ë°ì´íŠ¸
            updateStepIndicator(transformQueue = null) {
                if (this.totalSteps > 0) {
                    let stepText = `${this.currentStep}/${this.totalSteps}`;
                    
                    if (this.currentStep === 0) {
                        stepText += ' - ê¸°ë³¸ ë„í˜•';
                    } else if (transformQueue && this.currentStep > 0) {
                        const currentTransform = transformQueue.getAt(this.currentStep - 1);
                        if (currentTransform) {
                            stepText += ` - ${currentTransform.getDescription()}`;
                        }
                    }
                    
                    this.stepIndicator.textContent = stepText;
                    this.stepIndicator.classList.add('visible');
                    
                    // ì ì‹œ í›„ í‘œì‹œê¸° ìˆ¨ê¹€
                    setTimeout(() => {
                        this.stepIndicator.classList.remove('visible');
                    }, 2000);
                } else {
                    this.stepIndicator.classList.remove('visible');
                }
            }
            
            // ì „ì²´ ë‹¨ê³„ ì„¤ì •
            setTotalSteps(steps) {
                this.totalSteps = steps;
                this.currentStep = Math.min(this.currentStep, steps);
                this.updateStepIndicator();
            }
        }
        
        // ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë˜ìŠ¤
        class GeometricTransformApp {
            constructor() {
                // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
                this.canvas = document.getElementById('mainCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.resizeCanvas();
                
                // êµ¬ì„±ìš”ì†Œ ì´ˆê¸°í™”
                this.shape = new Shape('arrow');
                this.transformQueue = new TransformQueue(() => this.updateTransformations());
                this.matrixVisualization = new MatrixVisualization();
                this.animationController = new AnimationController(
                    (step) => this.animateStep(step),
                    () => this.resetApp()
                );
                
                // ìƒíƒœ ë³€ìˆ˜ ì´ˆê¸°í™”
                this.currentRotation = 0;
                this.currentScaleX = 1;
                this.currentScaleY = 1;
                this.currentShearX = 0;
                this.currentShearY = 0;
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                this.setupEventListeners();
                
                // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ ì‹œì‘
                this.startRenderLoop();
            }
            
            // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
            resizeCanvas() {
                const parent = this.canvas.parentElement;
                this.canvas.width = parent.clientWidth;
                this.canvas.height = parent.clientHeight;
            }
            
            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners() {
                // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ
                window.addEventListener('resize', () => this.resizeCanvas());
                
                // ë„í˜• ì„ íƒ ë²„íŠ¼
                const shapeButtons = document.querySelectorAll('.shape-btn');
                shapeButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        shapeButtons.forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.shape.setType(e.target.dataset.shape);
                    });
                });
                
                // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ - ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ì ìš©
                document.getElementById('rotationSlider').addEventListener('input', (e) => {
                    this.currentRotation = parseFloat(e.target.value);
                    document.getElementById('rotationValue').textContent = `${this.currentRotation}Â°`;
                    this.updateLivePreview();
                });
                
                document.getElementById('scaleXSlider').addEventListener('input', (e) => {
                    this.currentScaleX = parseFloat(e.target.value);
                    document.getElementById('scaleXValue').textContent = this.currentScaleX.toFixed(1);
                    this.updateLivePreview();
                });
                
                document.getElementById('scaleYSlider').addEventListener('input', (e) => {
                    this.currentScaleY = parseFloat(e.target.value);
                    document.getElementById('scaleYValue').textContent = this.currentScaleY.toFixed(1);
                    this.updateLivePreview();
                });
                
                document.getElementById('shearXSlider').addEventListener('input', (e) => {
                    this.currentShearX = parseFloat(e.target.value);
                    document.getElementById('shearXValue').textContent = this.currentShearX.toFixed(1);
                    this.updateLivePreview();
                });
                
                document.getElementById('shearYSlider').addEventListener('input', (e) => {
                    this.currentShearY = parseFloat(e.target.value);
                    document.getElementById('shearYValue').textContent = this.currentShearY.toFixed(1);
                    this.updateLivePreview();
                });
                
                // ë²„íŠ¼ ì´ë²¤íŠ¸
                document.getElementById('addRotationBtn').addEventListener('click', () => {
                    this.addRotationTransform();
                });
                
                document.getElementById('addScaleBtn').addEventListener('click', () => {
                    this.addScaleTransform();
                });
                
                document.getElementById('addShearBtn').addEventListener('click', () => {
                    this.addShearTransform();
                });
                
                document.getElementById('reflectXBtn').addEventListener('click', () => {
                    this.addReflectXTransform();
                });
                
                document.getElementById('reflectYBtn').addEventListener('click', () => {
                    this.addReflectYTransform();
                });
                
                document.getElementById('clearBtn').addEventListener('click', () => {
                    this.clearTransforms();
                });
            }
            
            // íšŒì „ ë³€í™˜ ì¶”ê°€
            addRotationTransform() {
                if (this.currentRotation !== 0) {
                    const transform = new Transform('rotation', { angle: this.currentRotation });
                    this.transformQueue.add(transform);
                    
                    // ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
                    this.currentRotation = 0;
                    document.getElementById('rotationSlider').value = 0;
                    document.getElementById('rotationValue').textContent = '0Â°';
                }
            }
            
            // í¬ê¸° ì¡°ì ˆ ë³€í™˜ ì¶”ê°€
            addScaleTransform() {
                if (this.currentScaleX !== 1 || this.currentScaleY !== 1) {
                    const transform = new Transform('scale', { 
                        sx: this.currentScaleX, 
                        sy: this.currentScaleY 
                    });
                    this.transformQueue.add(transform);
                    
                    // ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
                    this.currentScaleX = 1;
                    this.currentScaleY = 1;
                    document.getElementById('scaleXSlider').value = 1;
                    document.getElementById('scaleYSlider').value = 1;
                    document.getElementById('scaleXValue').textContent = '1.0';
                    document.getElementById('scaleYValue').textContent = '1.0';
                }
            }
            
            // ì „ë‹¨ ë³€í™˜ ì¶”ê°€
            addShearTransform() {
                if (this.currentShearX !== 0 || this.currentShearY !== 0) {
                    const transform = new Transform('shear', { 
                        shx: this.currentShearX, 
                        shy: this.currentShearY 
                    });
                    this.transformQueue.add(transform);
                    
                    // ìŠ¬ë¼ì´ë” ì´ˆê¸°í™”
                    this.currentShearX = 0;
                    this.currentShearY = 0;
                    document.getElementById('shearXSlider').value = 0;
                    document.getElementById('shearYSlider').value = 0;
                    document.getElementById('shearXValue').textContent = '0.0';
                    document.getElementById('shearYValue').textContent = '0.0';
                }
            }
            
            // Xì¶• ë°˜ì‚¬ ë³€í™˜ ì¶”ê°€
            addReflectXTransform() {
                const transform = new Transform('reflectX');
                this.transformQueue.add(transform);
            }
            
            // Yì¶• ë°˜ì‚¬ ë³€í™˜ ì¶”ê°€
            addReflectYTransform() {
                const transform = new Transform('reflectY');
                this.transformQueue.add(transform);
            }
            
            // ë³€í™˜ ëª¨ë‘ ì§€ìš°ê¸°
            clearTransforms() {
                this.transformQueue.clear();
                this.shape.setTransformMatrix(MathUtil.identityMatrix());
                this.matrixVisualization.update(MathUtil.identityMatrix());
                this.animationController.setTotalSteps(0);
            }
            
            // ë³€í™˜ ì—…ë°ì´íŠ¸
            updateTransformations() {
                const compositeMatrix = this.transformQueue.calculateCompositeMatrix();
                this.shape.setTransformMatrix(compositeMatrix);
                this.matrixVisualization.update(compositeMatrix);
                
                // ì• ë‹ˆë©”ì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ì— ë³€í™˜ í ê¸¸ì´ ì„¤ì •
                this.animationController.setTransformQueueLength(this.transformQueue.length);
            }
            
            // ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
            updateLivePreview() {
                // ê¸°ì¡´ íì˜ ë³µí•© í–‰ë ¬ ê³„ì‚°
                let compositeMatrix = this.transformQueue.calculateCompositeMatrix();
                
                // í˜„ì¬ ìŠ¬ë¼ì´ë” ê°’ìœ¼ë¡œ ì„ì‹œ ë³€í™˜ ìƒì„±
                const previewTransforms = [];
                
                // íšŒì „ì´ 0ì´ ì•„ë‹ˆë©´ ì¶”ê°€
                if (this.currentRotation !== 0) {
                    previewTransforms.push(new Transform('rotation', { angle: this.currentRotation }));
                }
                
                // í¬ê¸°ê°€ ê¸°ë³¸ê°’ì´ ì•„ë‹ˆë©´ ì¶”ê°€
                if (this.currentScaleX !== 1 || this.currentScaleY !== 1) {
                    previewTransforms.push(new Transform('scale', { 
                        sx: this.currentScaleX, 
                        sy: this.currentScaleY 
                    }));
                }
                
                // ì „ë‹¨ì´ 0ì´ ì•„ë‹ˆë©´ ì¶”ê°€
                if (this.currentShearX !== 0 || this.currentShearY !== 0) {
                    previewTransforms.push(new Transform('shear', { 
                        shx: this.currentShearX, 
                        shy: this.currentShearY 
                    }));
                }
                
                // ë¯¸ë¦¬ë³´ê¸° ë³€í™˜ë“¤ì„ ë³µí•© í–‰ë ¬ì— ì ìš©
                previewTransforms.forEach(transform => {
                    compositeMatrix = MathUtil.multiplyMatrix(compositeMatrix, transform.matrix);
                });
                
                // ë„í˜•ê³¼ í–‰ë ¬ ì‹œê°í™” ì—…ë°ì´íŠ¸
                this.shape.setTransformMatrix(compositeMatrix);
                this.matrixVisualization.update(compositeMatrix);
            }
            
            // íŠ¹ì • ë‹¨ê³„ê¹Œì§€ ì• ë‹ˆë©”ì´ì…˜
            // íŠ¹ì • ë‹¨ê³„ê¹Œì§€ ì• ë‹ˆë©”ì´ì…˜
            animateStep(step) {
                // ë‹¨ê³„ í‘œì‹œê¸° ì—…ë°ì´íŠ¸ (ì¬ìƒ/ë‹¨ê³„ë³„ ë²„íŠ¼ì—ì„œë§Œ í‘œì‹œ)
                this.animationController.updateStepIndicator(this.transformQueue);
                
                if (step <= 0 || this.transformQueue.length === 0) {
                    // 0ë‹¨ê³„: ê¸°ë³¸ ë„í˜• í‘œì‹œ
                    this.shape.setTransformMatrix(MathUtil.identityMatrix());
                    this.matrixVisualization.update(MathUtil.identityMatrix());
                    return;
                }
                
                let compositeMatrix = MathUtil.identityMatrix();
                
                for (let i = 0; i < step; i++) {
                    const transform = this.transformQueue.getAt(i);
                    if (transform) {
                        compositeMatrix = MathUtil.multiplyMatrix(compositeMatrix, transform.matrix);
                    }
                }
                
                // í˜„ì¬ ë‹¨ê³„ê¹Œì§€ì˜ ë³µí•© í–‰ë ¬ í‘œì‹œ
                this.matrixVisualization.update(compositeMatrix);
                
                // í˜„ì¬ ë³€í™˜ì˜ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                if (step > 0) {
                    const currentTransform = this.transformQueue.getAt(step - 1);
                    if (currentTransform) {
                        if (currentTransform.type === 'rotation') {
                            this.matrixVisualization.animateCell(0, 0);
                            this.matrixVisualization.animateCell(0, 1);
                            this.matrixVisualization.animateCell(1, 0);
                            this.matrixVisualization.animateCell(1, 1);
                        } else if (currentTransform.type === 'scale') {
                            this.matrixVisualization.animateCell(0, 0);
                            this.matrixVisualization.animateCell(1, 1);
                        } else if (currentTransform.type === 'shear') {
                            this.matrixVisualization.animateCell(0, 1);
                            this.matrixVisualization.animateCell(1, 0);
                        } else if (currentTransform.type === 'reflectX') {
                            this.matrixVisualization.animateCell(1, 1);
                        } else if (currentTransform.type === 'reflectY') {
                            this.matrixVisualization.animateCell(0, 0);
                        }
                    }
                }
                
                this.shape.setTransformMatrix(compositeMatrix);
            }
            
            // ì•± ë¦¬ì…‹
            resetApp() {
                this.shape.setTransformMatrix(MathUtil.identityMatrix());
                this.matrixVisualization.update(MathUtil.identityMatrix());
            }
            
            // ê·¸ë¦¬ê¸° ë£¨í”„ ì‹œì‘
            startRenderLoop() {
                const render = () => {
                    this.draw();
                    requestAnimationFrame(render);
                };
                
                render();
            }
            
            // ê·¸ë¦¬ê¸°
            draw() {
                // ìº”ë²„ìŠ¤ ì§€ìš°ê¸°
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
                this.drawGrid();
                
                // ì¢Œí‘œì¶• ê·¸ë¦¬ê¸°
                this.drawAxes();
                
                // ê¸°ì €ë²¡í„° ê·¸ë¦¬ê¸°
                this.drawBasisVectors();
                
                // ë„í˜• ê·¸ë¦¬ê¸°
                this.shape.draw(this.ctx, this.canvas.width / 2, this.canvas.height / 2);
            }
            
            // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
            drawGrid() {
                const gridSize = 50;
                const width = this.canvas.width;
                const height = this.canvas.height;
                const centerX = width / 2;
                const centerY = height / 2;
                
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                this.ctx.lineWidth = 1;
                
                // ìˆ˜ì§ì„ 
                for (let x = centerX % gridSize; x < width; x += gridSize) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, height);
                    this.ctx.stroke();
                }
                
                // ìˆ˜í‰ì„ 
                for (let y = centerY % gridSize; y < height; y += gridSize) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(width, y);
                    this.ctx.stroke();
                }
            }
            
            // ì¢Œí‘œì¶• ê·¸ë¦¬ê¸°
            drawAxes() {
                const width = this.canvas.width;
                const height = this.canvas.height;
                const centerX = width / 2;
                const centerY = height / 2;
                
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                this.ctx.lineWidth = 2;
                
                // Xì¶•
                this.ctx.beginPath();
                this.ctx.moveTo(0, centerY);
                this.ctx.lineTo(width, centerY);
                this.ctx.stroke();
                
                // Yì¶•
                this.ctx.beginPath();
                this.ctx.moveTo(centerX, 0);
                this.ctx.lineTo(centerX, height);
                this.ctx.stroke();
                
                // Xì¶• í™”ì‚´í‘œ
                this.ctx.beginPath();
                this.ctx.moveTo(width - 15, centerY - 8);
                this.ctx.lineTo(width - 5, centerY);
                this.ctx.lineTo(width - 15, centerY + 8);
                this.ctx.stroke();
                
                // Yì¶• í™”ì‚´í‘œ
                this.ctx.beginPath();
                this.ctx.moveTo(centerX - 8, 15);
                this.ctx.lineTo(centerX, 5);
                this.ctx.lineTo(centerX + 8, 15);
                this.ctx.stroke();
                
                // ì¶• ë ˆì´ë¸”
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                this.ctx.font = '16px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText('X', width - 20, centerY - 20);
                this.ctx.fillText('Y', centerX + 20, 20);
            }
            
            // ê¸°ì €ë²¡í„° ê·¸ë¦¬ê¸°
            drawBasisVectors() {
                const width = this.canvas.width;
                const height = this.canvas.height;
                const centerX = width / 2;
                const centerY = height / 2;
                
                // í˜„ì¬ ë³€í™˜ í–‰ë ¬ ê°€ì ¸ì˜¤ê¸°
                const matrix = this.shape.matrix;
                
                // i ê¸°ì €ë²¡í„° (ë³€í™˜ëœ xì¶• ë‹¨ìœ„ ë²¡í„°)
                const iVectorLength = 50;
                const iX = centerX + matrix[0][0] * iVectorLength;
                const iY = centerY + matrix[1][0] * iVectorLength;
                
                this.ctx.strokeStyle = '#FF5252';
                this.ctx.lineWidth = 2;
                this.ctx.beginPath();
                this.ctx.moveTo(centerX, centerY);
                this.ctx.lineTo(iX, iY);
                this.ctx.stroke();
                
                // i ë²¡í„° í™”ì‚´í‘œ
                const iAngle = Math.atan2(iY - centerY, iX - centerX);
                this.ctx.beginPath();
                this.ctx.moveTo(iX - 10 * Math.cos(iAngle - Math.PI / 6), iY - 10 * Math.sin(iAngle - Math.PI / 6));
                this.ctx.lineTo(iX, iY);
                this.ctx.lineTo(iX - 10 * Math.cos(iAngle + Math.PI / 6), iY - 10 * Math.sin(iAngle + Math.PI / 6));
                this.ctx.stroke();
                
                // j ê¸°ì €ë²¡í„° (ë³€í™˜ëœ yì¶• ë‹¨ìœ„ ë²¡í„°)
                const jVectorLength = 50;
                const jX = centerX + matrix[0][1] * jVectorLength;
                const jY = centerY + matrix[1][1] * jVectorLength;
                
                this.ctx.strokeStyle = '#4FC3F7';
                this.ctx.beginPath();
                this.ctx.moveTo(centerX, centerY);
                this.ctx.lineTo(jX, jY);
                this.ctx.stroke();
                
                // j ë²¡í„° í™”ì‚´í‘œ
                const jAngle = Math.atan2(jY - centerY, jX - centerX);
                this.ctx.beginPath();
                this.ctx.moveTo(jX - 10 * Math.cos(jAngle - Math.PI / 6), jY - 10 * Math.sin(jAngle - Math.PI / 6));
                this.ctx.lineTo(jX, jY);
                this.ctx.lineTo(jX - 10 * Math.cos(jAngle + Math.PI / 6), jY - 10 * Math.sin(jAngle + Math.PI / 6));
                this.ctx.stroke();
                
                // ë²¡í„° ë ˆì´ë¸”
                this.ctx.fillStyle = '#FF5252';
                this.ctx.font = '16px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText('i', iX + 15 * Math.cos(iAngle), iY + 15 * Math.sin(iAngle));
                
                this.ctx.fillStyle = '#4FC3F7';
                this.ctx.fillText('j', jX + 15 * Math.cos(jAngle), jY + 15 * Math.sin(jAngle));
            }
        }
        
        // ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        document.addEventListener('DOMContentLoaded', () => {
            const app = new GeometricTransformApp();
        });
    </script>
</body>
</html>
